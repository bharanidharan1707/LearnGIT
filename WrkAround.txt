
WITH 
cte_totcount AS
(
   select hacker_id, challenge_id, sum(score) as totscore from
     submissions xx
    where score <> 0
     group by hacker_id,challenge_id,score
     having score = (select MAX(score) from submissions where hacker_id=xx.hacker_id and
                    challenge_id = xx.challenge_id)
 ),
 cte_final AS 
 (
     select t1.hacker_id,name, sum(totscore) as totscore from
     cte_totcount t1 join hackers t2 on t1.hacker_id = t2.hacker_id
     group by t1.hacker_id,name
 )
 select * from cte_final
 order by totscore desc,  hacker_id asc
 
 


